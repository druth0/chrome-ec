/* Copyright 2025 The ChromiumOS Authors
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 *
 * Renesas (Intersil) ISL-95522 battery charger driver header.
 */

#ifndef __CROS_EC_ISL95522_H
#define __CROS_EC_ISL95522_H

#include "driver/charger/isl95522_public.h"

#define CHARGER_NAME "ISL95522"
#define CHARGE_V_MAX 18432
#define CHARGE_V_MIN 64
#define CHARGE_V_STEP 16
/*
 * When the default sense resistor value is used, register values
 * represent mA. For other sense resistors values, register
 * values must be scaled accordingly to convert to mA.
 */
#define CHARGE_I_MAX 8160
#define CHARGE_I_MIN 32
#define CHARGE_I_STEP 32
#define INPUT_I_MAX 8064
#define INPUT_I_MIN 128
#define INPUT_I_STEP 128

/* Registers */

/*
 * ChargeCurrentLimit [12:5] 8-bit (0x0000h = disables fast charging,
 * trickle charging is allowed)
 */
#define ISL95522_REG_CHG_CURRENT_LIMIT 0x14

/* MaxSystemVoltage [14:4] 11-bit, (0x0000h = disables switching) */
#define ISL95522_REG_MAX_SYSTEM_VOLTAGE 0x15

/* Configures prochot debounce */
#define ISL95522_REG_PROCHOT_DEBOUNCE 0x39
#define ISL95522_REG_PROCHOT_DEBOUNCE_MASK GENMASK(1, 0)
#define ISL95522_REG_PROCHOT_DEBOUNCE_SHIFT 0
#define ISL95522_REG_PROCHOT_DEBOUNCE_10US 0
#define ISL95522_REG_PROCHOT_DEBOUNCE_100US 1
#define ISL95522_REG_PROCHOT_DEBOUNCE_500US 2
#define ISL95522_REG_PROCHOT_DEBOUNCE_1MS 3

/* Configures prochot duration */
#define ISL95522_REG_PROCHOT_DURATION 0x3A
#define ISL95522_REG_PROCHOT_DURATION_MASK GENMASK(2, 0)
#define ISL95522_REG_PROCHOT_DURATION_SHIFT 0
#define ISL95522_REG_PROCHOT_DURATION_0MS 0
#define ISL95522_REG_PROCHOT_DURATION_20MS 1
#define ISL95522_REG_PROCHOT_DURATION_15MS 2
#define ISL95522_REG_PROCHOT_DURATION_10MS 3
#define ISL95522_REG_PROCHOT_DURATION_5MS 4
#define ISL95522_REG_PROCHOT_DURATION_1MS 5
#define ISL95522_REG_PROCHOT_DURATION_500US 6
#define ISL95522_REG_PROCHOT_DURATION_100US 7

#define ISL95522_REG_ADAPTER_CUR_LIMIT2 0x3B

/* Configures various charger options */
#define ISL95522_REG_CONTROL2 0x3C
/*
 * 3:0 - Switching Frequency
 */
#define ISL95522_CONTROL2_SWITCHING_FREQ_MASK GENMASK(3, 0)
#define ISL95522_CONTROL2_SWITCHING_FREQ_SHIFT 0
#define ISL95522_CONTROL2_SWITCHING_FREQ_BY_FSET 0
#define ISL95522_CONTROL2_SWITCHING_FREQ_356KHZ 1
#define ISL95522_CONTROL2_SWITCHING_FREQ_375KHZ 2
#define ISL95522_CONTROL2_SWITCHING_FREQ_396KHZ 3
#define ISL95522_CONTROL2_SWITCHING_FREQ_400KHZ 4
#define ISL95522_CONTROL2_SWITCHING_FREQ_427KHZ 5
#define ISL95522_CONTROL2_SWITCHING_FREQ_453KHZ 6
#define ISL95522_CONTROL2_SWITCHING_FREQ_487KHZ 7
#define ISL95522_CONTROL2_SWITCHING_FREQ_491KHZ 8
#define ISL95522_CONTROL2_SWITCHING_FREQ_533KHZ 9
#define ISL95522_CONTROL2_SWITCHING_FREQ_583KHZ 10
#define ISL95522_CONTROL2_SWITCHING_FREQ_644KHZ 11
#define ISL95522_CONTROL2_SWITCHING_FREQ_610KHZ 12
#define ISL95522_CONTROL2_SWITCHING_FREQ_693KHZ 13
#define ISL95522_CONTROL2_SWITCHING_FREQ_796KHZ 14
#define ISL95522_CONTROL2_SWITCHING_FREQ_942KHZ 15

#define ISL95522_REG_CONTROL2_TRICKLE_CHARGE BIT(7)

/* Configures various charger options */
#define ISL95522_REG_CONTROL1 0x3D
#define ISL95522_REG_CONTROL1_STANDBY_MODE BIT(0)
#define ISL95522_REG_CONTROL1_LEARN_MODE BIT(1)
#define ISL95522_REG_CONTROL1_AMON BIT(2)
#define ISL95522_REG_CONTROL1_BMON BIT(3)
#define ISL95522_REG_CONTROL1_PSYS BIT(4)
#define ISL95522_REG_CONTROL1_TURBO_MODE BIT(10)
#define ISL95522_REG_CONTROL1_WOCP BIT(11)
#define ISL95522_REG_CONTROL1_ENABLE_CHARGING BIT(12)

/* MinSystemVoltage [13:8] 6-bit (0x0000h = disables all battery charging) */
#define ISL95522_REG_MIN_SYSTEM_VOLTAGE 0x3E

#define ISL95522_REG_ADAPTER_CUR_LIMIT1 0x3F
#define ISL95522_REG_VIN_VOLTAGE 0x40
#define ISL95522_REG_INFORMATION2 0x45

#define ISL95522_REG_INFORMATION1 0x46
#define ISL95522_REG_INFORMATION1_AC_PRESENT BIT(0)

#define ISL95522_REG_AC_PROCHOT 0x47
#define ISL95522_REG_DC_PROCHOT 0x48
#define ISL95522_REG_MANUFACTURER_ID 0xFE
#define ISL95522_REG_DEVICE_ID 0xFF

/* Sense resistor default values in milli Ohm */
#define ISL95522_DEFAULT_RS1 10 /* Input current sense resistor */
#define ISL95522_DEFAULT_RS2 10 /* Battery charge current sense resistor */

#define BOARD_RS1 CONFIG_CHARGER_SENSE_RESISTOR_AC
#define BOARD_RS2 CONFIG_CHARGER_SENSE_RESISTOR

#define BC_REG_TO_CURRENT(REG) (((REG) * ISL95522_DEFAULT_RS2) / BOARD_RS2)
#define BC_CURRENT_TO_REG(CUR) (((CUR) * BOARD_RS2) / ISL95522_DEFAULT_RS2)

#define AC_REG_TO_CURRENT(REG) (((REG) * ISL95522_DEFAULT_RS1) / BOARD_RS1)
#define AC_CURRENT_TO_REG(CUR) (((CUR) * BOARD_RS1) / ISL95522_DEFAULT_RS1)

#endif /* __CROS_EC_ISL95522_H */
